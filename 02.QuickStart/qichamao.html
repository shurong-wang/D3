<!DOCTYPE html>
<html lang="zh-CN" class="hdmap-html">

<head>
    <title>企业图谱_企业关系查询_公司股权结构图-企查猫(企业查询宝)</title>
    <meta name="description" content="企查猫(企业查询宝)提供企业图谱、关系查询、股权结构图、疑似关系等功能查询，剖析目标企业关联信息，深度挖掘企业间错综复杂的关系，让你更全面直观的了解公司的投资经营状况。">
    <meta name="keywords" content="企业图谱，企业关系查询，公司股权结构图">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-itunes-app" content="app-id=1308145246">
    <title>企查猫(企业查询宝)-企业图谱</title>
    <link rel="stylesheet" href="https://img1.qianzhan.com/qiye/20171201/content/common.css" />
    <link rel="stylesheet" href="https://img1.qianzhan.com/qiye/20171201/content/site.css">
    <link rel="stylesheet" href="https://img1.qianzhan.com/qiye/20171201/content/hdmap.css">
    <link rel="stylesheet" media="screen and (max-width: 1139px)" href="https://img1.qianzhan.com/qiye/20171201/content/media.min.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/touch-icon-iphone-114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/images/touch-icon-ipad-144.png" />
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/NewMap/jquery-1.10.2.min.js"></script>


    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/app.min.js?v=V6"></script>
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/NewMap/d3.min.js"></script>
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/NewMap/echarts2.js"></script>
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/NewMap/d3_2.js"></script>
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/NewMap/rgbcolor.js"></script>
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/NewMap/StackBlur.js"></script>
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/NewMap/canvg.js"></script>
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/NewMap/download.js"></script>
    <script type="text/javascript">
        // 百度统计
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?55ad112b0079dd9ab00429af7113d5e3";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();

        var currURL = window.location.href.toLowerCase();
        $(function () {
            $(".hdmap2-old").click(function () {
                var comname = $(".hdmap2-tit").text().trim();
                comname = encodeURIComponent(comname);
                if (comname.length > 0) {
                    location.href = "/orgcompany/map#D3Force/" + comname + "/2/1/0";
                } else {
                    comname = "深圳前瞻资讯股份有限公司";
                    location.href = "/orgcompany/map#D3Force/" + comname + "/2/1/0";
                }

            });

            $(".dep-hdbar_fm_icon").click(function () {
                $("#sbar").addClass("open");
            });

            if ($('#comName').val().trim().length > 0) {
                $(".hdmap2-tit").text($('#comName').val().trim());
            }


            $(".openShare").click(function () {
                console.log(this);
                if ($(this).attr("data-openType") == 1) {
                    $(".sharebar").show();
                    $(this).attr("data-openType", "0");
                } else {
                    $(".sharebar").hide();
                    $(this).attr("data-openType", "1");
                }
            });

            //分享点击事件
            $(".sharebar_icon").click(function () {
                share($(this).attr("data-share"))
            })


            $("#comName").mouseover(function () {
                //$(".open-txt").removeClass("open").addClass("open");
                var hastxt = $("#ullist").text().length;
                if (hastxt <= 0) {
                    $("#ullist").hide();
                } else {
                    $("#ullist").show();
                }
            });
            $("#ullist").mouseleave(function () {
                //$(".open-txt").removeClass("open");
                $("#ullist").hide();
            });

            $("#ullist").click(function (event) {
                $("#ullist").hide();
            });


            var keycount = -1;
            //智能提示加载
            $("#comName").keyup(function (event) {
                if (event.keyCode == 13) {
                    var hasSelect = $("#ullist").find("li[style]");
                    if (hasSelect.length <= 0) {
                        keycount = -1;
                        return false;
                    }

                    $('#SearchName').val($('#comName').val());
                    $(".hdmap2-tit").text($('#comName').val());
                    $("#ullist").hide();
                    if (currURL.indexOf("ownertype=1") > -1) {
                        window.location = "/orgcompany/comownership?searchname=" + encodeURIComponent($('#comName').val()) + "&ownertype=1";
                    } else {
                        changeURL();
                        getData($('#comName').val());
                    }
                    return;
                }
                //向下
                if (event.keyCode == 40) {
                    if ($("#ullist li").length > 0) {
                        if (keycount >= $("#ullist li").length - 1) {
                            keycount = 0;
                        } else {
                            keycount++;
                        }
                        $("#ullist").find("li").css("backgroundColor", "");
                        $("#ullist").find("li").eq(keycount).css("backgroundColor", "#f1f5f8");
                        $("#comName").val($("#ullist").find("li").eq(keycount).text());
                        return;
                    }
                }
                //向上
                else if (event.keyCode == 38) {
                    if ($("#ullist li").length > 0) {
                        if (keycount > 0) {
                            keycount--;
                        } else {
                            keycount = $("#ullist li").length - 1;
                        }
                        $("#ullist").find("li").css("backgroundColor", "");
                        $("#ullist").find("li").eq(keycount).css("backgroundColor", "#f1f5f8");
                        $("#comName").val($("#ullist").find("li").eq(keycount).text());
                        return;
                    }
                }
            });

            //监控文本变化
            $('#comName').bind('input propertychange', function () {
                if ($("#comName").val() == "") {
                    $("#ullist").hide();
                    return;
                }
                searchCompany();
            });

            $(document).on("click", ".alink", function () {
                $('#comName').val($(this).text().trim());
                $('#SearchName').val($(this).text().trim());
                $(".hdmap2-tit").text($(this).text().trim());
                $("#ullist").hide();
                if (currURL.indexOf("ownertype=1") > -1) {
                    window.location = "/orgcompany/comownership?searchname=" + encodeURIComponent($(this).text().trim()) + "&ownertype=1";
                } else {
                    changeURL();
                    getData($(this).text().trim());
                }

                $("#sbar").removeClass("open");

            });

            $(".hdmap2-tab a").click(function () {
                var url = $(this).attr("data-href") + "?SearchName=" + encodeURIComponent($("#comName").val().trim());
                if (($(this).attr("data-href").indexOf("comownership") > -1)) {
                    url = url + "&OwnerType=" + $(this).attr("data-OwnerType");
                }
                window.location = url;
            });

            $(document).on("click", ".close", function () {
                $(".hdmappop2").hide();
            });

            $(document).on("click", ".hdmappop2-tab a", function () {
                $(this).removeClass("current").addClass("current").siblings().removeClass("current");
                var type = $(this).attr("data-showNum");
                switch (type) {
                    case "1":
                        $("#show1").show().siblings().hide();
                        break;
                    case "2":
                        $("#show2").show().siblings().hide();
                        break;
                    case "3":
                        $("#show3").show().siblings().hide();
                        break;
                    case "4":
                        $("#show4").show().siblings().hide();
                        break;
                    case "5":
                        $("#show5").show().siblings().hide();
                        break;
                    default:
                        $("#show1").show().siblings().hide();
                        break;
                }
            });

            $(document).on("click", "#moreList", function () {
                var page = $(this).attr("data-page");
                var pagesize = $(this).attr("data-pagesize");
                var orgCode = $(this).attr("data-orgCode");
                page = parseInt(page);

                $.ajax({
                    url: "/OrgCompany/JudgeListByRelation",
                    type: 'POST',
                    data: {
                        "page": page,
                        "pagesize": pagesize,
                        "orgCode": orgCode,
                        "toCode": $("#hdtokeyNo").val(),
                    },
                    //dataType: 'JSON',
                    success: function (data) {
                        if (data.isSuccess) {
                            var html = "";
                            $.each(data.dataList, function (index, e) {
                                html += '<div class="hdmappop2-pjs">';
                                html += '<div class="hdmappop2-pjs_tit"><span>' + ((page - 1) * 10 + index + 1) + '</span><a target="_blank" href="/judge/dtl/' + e.judgeid + '.html">查看详情</a></div>';
                                html += '<table class="hdmappop2-pjs_tb">';
                                html += '<tr><td valign="top">时间：</td><td>' + e.date + '</td></tr>';
                                html += '<tr><td valign="top">判决书：</td><td>' + e.name + '</td></tr>';
                                html += '<tr><td valign="top">案号：</td><td>' + e.reference + '</td></tr>';
                                html += '<tr><td valign="top">法院：</td><td>' + e.court + '</td></tr>';
                                //html += '<tr><td class="dsr">原告 : </td><td class="dsr">岳长运</td></tr>';
                                //html += '<tr><td>被告 : </td><td>温锋</td></tr>';
                                //html += '<tr><td></td><td>海南天涯社区网络科技股份有限公司</td></tr>';
                                html += '</table>';
                                html += '</div>';
                            });
                            if (data.dataList.length == 10) {
                                page++;
                                html += '<div class="load-wrap hdmappop2-pjs-more"><a id="moreList" class="more-load" data-page="' + page + '" data-pagesize="10" data-orgCode="' + orgCode + '" href="javascript:void(0);" >查看更多</a></div>';
                            }
                            $("#moreList").remove();
                            $("#show4").append(html);
                        } else {
                            //$(this).remove();
                            $("#moreList").remove();
                        }

                    }
                    //async: false
                });

            });

            var arrURL = $(".hdmap2-tab a");
            arrURL.each(function () {
                var temp = $(this).attr("data-href");
                if (currURL.indexOf(temp) > -1) {
                    if (currURL.indexOf("ownertype=0") > -1) {
                        $(".hdmap2-tab a[data-OwnerType='0']").removeClass("current").addClass("current").siblings().removeClass("current");
                    } else if (currURL.indexOf("ownertype=1") > -1) {
                        $(".hdmap2-tab a[data-OwnerType='1']").removeClass("current").addClass("current").siblings().removeClass("current");
                    } else {
                        $(this).removeClass("current").addClass("current").siblings().removeClass("current");
                    }

                }
            });


            //手机右上角菜单事件
            $(".icon-menu").click(function () {
                if ($(".hd").hasClass("open-menu")) {
                    $(".hd").removeClass("open-menu");
                } else {
                    $(".hd").addClass("open-menu");
                    PhoneBr(function () {
                        $(".bg-fixed").show();
                        if ($(".comm-pf .art-share") != null && $(".comm-pf .art-share") != undefined) {
                            $(".comm-pf .art-share").css("z-index", 0);
                        }
                    }, function () {
                        $(".hd").removeClass("open-menu");
                    });
                }
            });



            //菜单里面的返回事件
            $(".return").click(function () {
                $(".bg-fixed").hide();
                $(".hd").removeClass("open-menu");
            });
        });

        //searchCompany 模糊查询获取公司名
        function searchCompany() {

            var tip = $('#comName').val().trim();
            if (!tip || tip == '') {
                return;
            }
            $.post("/orgcompany/SearchMapCompany", { "tip": tip }, function (data) {
                if (data.isSuccess) {
                    var content = "";
                    $.each(data.dataList, function (i, item) {
                        var comname = item.companyName.replace(tip, "<em>" + tip + "</em>");
                        content += '<li class="alink">' + comname + '</li>';
                    });
                }
                $("#ullist").empty().append(content);
                $("#ullist").show();
                //$(".open-txt").removeClass("open").addClass("open");
            });
        }

        //function verify(callback) {
        //    $.getScript("/home/GetJsVerfyCode?t=" + Math.random(), function () {

        //        if (window.__qzmcf) {
        //            callback(window.__qzmcf());
        //        } else {
        //            messageHelper.handle('info', '无法验证票据，请尝试刷新页面', window.top.document);
        //        }

        //    });
        //}

        //获取公司信息
        function getCompanyInfo(keyNo, category) {
            $.post('/orgcompany/getcompanyshortinfo2', { "keyNo": keyNo, "category": category, "tokeyNo": $("#hdtokeyNo").val() }, function (result) {
                if (result.isSuccess) {
                    var lidata = eval("(" + result.dataList.data + ")");
                    //var gudongarr = lidata.children.filter(e=>e.Category === 2);
                    //var gaoduanarr = lidata.children.filter(e=>e.Category === 3);
                    //var touziarr = lidata.children.filter(e=>e.Category === 1);

                    var gudongarr = new Array();
                    var gaoduanarr = new Array();
                    var touziarr = new Array();

                    for (var i = 0; i < lidata.children.length; i++) {
                        if (lidata.children[i].Category == 2) {
                            gudongarr.push(lidata.children[i]);
                        }
                        if (lidata.children[i].Category == 3) {
                            gaoduanarr.push(lidata.children[i]);
                        }
                        if (lidata.children[i].Category == 1) {
                            touziarr.push(lidata.children[i]);
                        }
                    }
                    var html = '';
                    //<!-- 企业图谱弹出信息框 -->
                    html += '<div class="hdmappop2-tit">公司信息</div>';
                    html += '<div class="hdmappop2-info">';
                    html += '<div class="tit"><span>' + result.dataList.status + '</span><em>' + lidata.name + '</em></div>';
                    html += '<div class="info-wrap">';
                    html += '<div class="info"><span>企业法人：</span>' + result.dataList.legalRepresentative + '</div>';
                    html += '<div class="info"><span>注册资本：</span>' + result.dataList.regMoney + '</div>';
                    html += '<div class="info"><span>成立时间：</span>' + result.dataList.foundDate + '</div>';
                    html += '</div>';
                    html += '<div class="btn-wrap"><a href="/orgcompany/comrelation?SearchName=' + encodeURIComponent(lidata.name) + '" class="btn green">企业图谱</a><a href="/orgcompany/searchitemdtl/' + result.dataList.orgCode + '.html" class="btn green" target="blank">企业详情</a></div>';
                    html += '</div>';
                    html += '<div class="hdmappop2-tab">';
                    if (category == "4")//判决文书
                    {
                        html += '<a href="javascript:void(0);" data-showNum="4" class="current">判决文书</a>';
                        html += '<a href="javascript:void(0);" data-showNum="1" >股东</a><a href="javascript:void(0);" data-showNum="2">高管</a><a href="javascript:void(0);" data-showNum="3">对外投资</a>';
                    } else if (category == "5")//法院公告
                    {
                        html += '<a href="javascript:void(0);" data-showNum="5" class="current">法院公告</a>';
                        html += '<a href="javascript:void(0);" data-showNum="1" >股东</a><a href="javascript:void(0);" data-showNum="2">高管</a><a href="javascript:void(0);" data-showNum="3">对外投资</a>';
                    } else {
                        html += '<a href="javascript:void(0);" data-showNum="1" class="current">股东</a><a href="javascript:void(0);" data-showNum="2">高管</a><a href="javascript:void(0);" data-showNum="3">对外投资</a>';
                    }
                    html += '</div>';

                    html += '<div>';
                    if (category == "4" || category == "5") {
                        html += '<div class="hdmappop2-box" id="show1" style="display: none;">';
                    } else {
                        html += '<div class="hdmappop2-box" id="show1" style="display: ;">';
                    }
                    html += '<table class="hdmappop2-gd ">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<th>名称</th>';
                    html += '<th>出资比例</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
                    $.each(gudongarr[0].children, function (index, data) {
                        html += '<tr>';
                        html += '<td>' + data.name + '</td>';
                        html += '<td>' + data.des + '</td>';
                        html += '</tr>';
                    });
                    html += '</tbody>';
                    html += '</table>';
                    html += '</div>';

                    html += '<div class="hdmappop2-box" id="show2" style="display: none;">';
                    html += '<table class="hdmappop2-gd ">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<th>名称</th>';
                    html += '<th>职位</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
                    $.each(gaoduanarr[0].children, function (index, data) {
                        html += '<tr>';
                        html += '<td>' + data.name + '</td>';
                        html += '<td>' + data.des + '</td>';
                        html += '</tr>';
                    });
                    html += '</tbody>';
                    html += '</table>';
                    html += '</div>';

                    html += '<ul class="hdmappop2-tzr hdmappop2-box" id="show3" style="display: none;">';
                    $.each(touziarr[0].children, function (index, data) {
                        html += '<li><i class="squ"></i><em>' + data.name + '</em></li>';
                        //html+='<li><i class="squ"></i><a href="">南京颂歌网络科技有限公司南京颂歌网络科技有限公司南京颂歌网络科技有限公司</a></li>';
                    });
                    html += '</ul>';

                    if (category == "4")//判决文书
                    {
                        html += '<div class="hdmappop2-box" id="show4">';
                        $.each(result.dataList.jude_list.judge_list.docs, function (index, data) {

                            html += '<div class="hdmappop2-pjs">';
                            html += '<div class="hdmappop2-pjs_tit"><span>' + (index + 1) + '</span><a target="_blank" href="/judge/dtl/' + data.doc.jd_id + '.html">查看详情</a></div>';
                            html += '<table class="hdmappop2-pjs_tb">';
                            html += '<tr><td valign="top">时间：</td><td>' + data.doc.jd_date_str + '</td></tr>';
                            html += '<tr><td valign="top">判决书：</td><td>' + data.doc.jd_title + '</td></tr>';
                            html += '<tr><td valign="top">案号：</td><td>' + data.doc.jd_num + '</td></tr>';
                            html += '<tr><td valign="top">法院：</td><td>' + data.doc.jd_court + '</td></tr>';
                            //html += '<tr><td class="dsr">原告 : </td><td class="dsr">岳长运</td></tr>';
                            //html += '<tr><td>被告 : </td><td>温锋</td></tr>';
                            //html += '<tr><td></td><td>海南天涯社区网络科技股份有限公司</td></tr>';
                            html += '</table>';
                            html += '</div>';
                        });
                        html += '<div class="load-wrap hdmappop2-pjs-more"><a id="moreList" class="more-load" data-page="2" data-pagesize="10" data-orgCode="' + result.dataList.orgCode + '" href="javascript:void(0);" >查看更多</a></div>';
                    }


                    if (category == "5")//法院公告
                    {
                        html += '<div class="hdmappop2-box" id="show5">';
                        $.each(result.dataList.notice_list.docs, function (index, data) {
                            html += '<div class="hdmappop2-pjs">';
                            html += '<div class="hdmappop2-pjs_tit"><span>' + (index + 1) + '</span>';
                            //html += '<a href="">查看详情</a>';
                            html += '</div>';
                            html += '<table class="hdmappop2-pjs_tb">';
                            html += '<tr><td valign="top">时间：</td><td>' + data.doc.gg_publishdate_str + '</td></tr>';
                            html += '<tr><td valign="top">案号：</td><td>' + data.doc.gg_caseno + '</td></tr>';
                            html += '<tr><td valign="top">法院：</td><td>' + data.doc.gg_court + '</td></tr>';
                            html += '<tr><td class="dsr" valign="top">原告 : </td><td class="dsr">' + data.doc.gg_plaintiff + '</td></tr>';
                            html += '<tr><td valign="top">被告 : </td><td>' + data.doc.gg_accused + '</td></tr>';
                            //html += '<tr><td></td><td>' + data.doc.gg_caseno + '</td></tr>';
                            html += '</table>';
                            html += '</div>';
                        });
                        //html += '<div class="load-wrap hdmappop2-pjs-more"><a class="more-load">查看更多</a></div>';
                    }


                    html += '</div>';
                    html += '</div>';
                    html += '<i class="close">×</i>';
                    $(".hdmappop2").empty().append(html).show();
                }
            });
        }


        function share(dest) {
            var url = window.location.href.toString();
            var title = $('.hdmap2-tit').text() + ' 的企业图谱' + '@企查猫(企业查询宝)';
            var summary = $('.hdmap2-tit').text() + ' 的企业图谱' + '@企查猫(企业查询宝)';;
            shareTo(dest, url, title, summary)
        }

        function changeURL() {
            var tmpURL = "";
            if (currURL.indexOf("ownertype=1") > -1) {
                tmpURL = "/orgcompany/comownership?searchname=" + encodeURIComponent($('#comName').val()) + "&ownertype=1";
            } else if (currURL.indexOf("ownertype=0") > -1) {
                tmpURL = "/orgcompany/comownership?searchname=" + encodeURIComponent($('#comName').val()) + "&ownertype=0";
            } else if (currURL.indexOf("comgenealogy") > -1) {
                tmpURL = "/orgcompany/comgenealogy?searchname=" + encodeURIComponent($('#comName').val()) + "";
            } else if (currURL.indexOf("cominvestment") > -1) {
                tmpURL = "/orgcompany/comgenealogy?searchname=" + encodeURIComponent($('#comName').val()) + "";
            } else if (currURL.indexOf("comrelation") > -1) {
                tmpURL = "/orgcompany/comrelation?searchname=" + encodeURIComponent($('#comName').val()) + "";
            }
            history.pushState(null, "企业图谱_企业关系查询_公司股权结构图-企查猫(企业查询宝)", tmpURL);
        }
    </script>
    <!--[if lt IE 9]>
        <script src="js/html5shiv.min.js"></script>
    <![endif]-->
    <!--[if lt IE 10]>
        <link rel="stylesheet" href="css/site-ie8.css">
    <![endif]-->
</head>
<!-- 添加或者删除 open-fullscreen 类名控制全屏，或者退出全屏 -->

<body class="hdmap-bd hdmap2-bd ">
    <!--
    //头部，导航，登录，APP下载按钮,open-menu,控制手机下右侧导航展开
    // 当有消息的时候，添加类名 open-mc,显示消息
     -->
    <!--
    // 头部，导航，登录，APP下载按钮,open-menu,控制手机下右侧导航展开
    // 当有消息的时候，添加类名 open-mc,显示消息
    // 头部悬浮，添加类名 hdbar--fixed
     -->
    <header class="hdbar hdbar--height hdbar--has-fm   open-mc hdbar--logged">
        <i class="icon-menu hdbar_menuicon"></i>
        <div class="wrap-w hdbar_wrap">
            <a class="hdbar_logo" href="/">
                <svg viewBox="0 0 230 36" class="hdbar_logo_svg">
                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#logo-qcm-f"></use>
                </svg>
            </a>
            <!-- 手机端添加类名 open ,展开输入框-->
            <div id="sbar" class="hdbar_fm ">
                <input class="hdbar_txt" type="text" autocomplete="off" name="" placeholder="请输入企业名称、人名、产品名等关键词,如“唯品会”" id="comName">
                <button class="hdbar_btn" onclick="searchCompany()">
                    <i class="icon-search"></i>
                </button>
                <i class="icon-search hdbar_fm_icon dep-hdbar_fm_icon"></i>

                <ul class="sec-tips" id="ullist"></ul>

            </div>

            <div class="hdbar_box">
                <nav class="hdbar_nav">
                    <a href="/">首页</a>
                    <a href="/show">企业说</a>
                    <a href="/baike">企业百科</a>
                    <a href="/vip/vipopen?t=2" target="_blank">VIP特权</a>
                    <a href="/app/app.html" target="_blank">APP下载</a>
                    <a href="https://stock.qianzhan.com/" target="_blank">上市企业专业版</a>
                    <div class="dropdown hdbar_dropdown " id="menu-dropdown">
                        <button class="dropdown-toggle">更多
                            <i class="caret"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="/bbs/list">互动社区</a>
                            </li>
                            <li>
                                <a href="/cert-wall" target="_blank">企业播</a>
                            </li>
                            <li>
                                <a href="https://open.qianzhan.com" target="_blank">数据接口</a>
                            </li>
                        </ul>
                    </div>
                </nav>

                <div class="hdbar_login">
                    <a href="/usercenter/login">登录</a>
                    <a href="/usercenter/register">免费注册</a>
                </div>


                <div class="dropdown hdbar_user hdbar_dropdown " id="menu-dropdown-name">
                    <button class="dropdown-toggle">
                        <span class="hdbar_user_face face">

                            <img class="hdbar_user_img img" src="https://face.qianzhan.com/90/40/4841840.large.gif" alt="" />

                        </span>
                        <span class="hdbar_user_name">qycxb_5400146571604921296</span>
                        <i class="caret"></i>
                        <a href="/usercenter/mymsg" class="hdbar_user_link"></a>
                    </button>
                    <div class="dropdown-menu">
                        <ul class="dropdown-list">
                            <li>
                                <a href="/usercenter/mymsg" class="hdbar_user_msg">消息中心
                                    <em>7</em>
                                </a>
                            </li>
                            <li>
                                <a href="/usercenter/myorder">我的账户</a>
                            </li>
                            <li>
                                <a href="usercenter-invoice.html" style="display: none">发票申请</a>
                            </li>
                            <li>
                                <a href="workbench.html" target="_blank" style="display: none">专题工作台</a>
                            </li>
                        </ul>
                        <ul class="dropdown-list">
                            <li>
                                <a href="/usercenter/favorite">我的收藏</a>
                            </li>
                            <li>
                                <a href="/usercenter/searchhistory">搜索历史</a>
                            </li>
                            <li>
                                <a href="/usercenter/browsinghistory">浏览记录</a>
                            </li>
                        </ul>
                        <ul class="dropdown-list">
                            <li>
                                <a href="/usercenter/mybbs">我的动态</a>
                            </li>
                            <li>
                                <a href="/usercenter/setting">用户设置</a>
                            </li>
                            <li>
                                <a href="/usercenter/logout">退出登录</a>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>
        </div>
    </header>

    <!-- 搜索，添加类名 secbox-fixed 悬浮 -->
    <!-- 企业图谱 -->
    <article class="hdmap hdmap2">
        <div class="hdmap2-con">
            <h1 class="hdmap2-tit">深圳前瞻资讯股份有限公司</h1>
            <div class="hdmap2-tab">
                <a data-href="/orgcompany/comgenealogy" href="javascript:void(0);">企业图谱</a>
                <a data-href="/orgcompany/cominvestment" href="javascript:void(0);">投资族谱</a>
                <a data-href="/orgcompany/comrelation" href="javascript:void(0);">疑似关系</a>
                <a data-href="/orgcompany/comownership" data-OwnerType="0" href="javascript:void(0);">股权结构图</a>
                <a data-href="/orgcompany/comownership" data-OwnerType="1" href="javascript:void(0);">疑似控制人</a>
            </div>
        </div>
        <input id="hdtokeyNo" type="hidden" value="" />
        <!-- <iframe src="svg/hdmap.svg" height="100%" width="100%" allowtransparency="true" ></iframe> -->



        <a id="alink" href="" target="_blank" style="visibility: hidden;"></a>
        <ul class="hdmap2-tool " style="z-index:1100;">
            <li class="hdmap2-tool_item" title="导出" onclick="saveImg()">
                <svg class="svg-export hdmap2-tool_icon" viewBox="0 0 16 11.84">
                    <use xlink:href="#export"></use>
                </svg>
            </li>
            <li class="hdmap2-tool_item" title="刷新" onclick="maoRefresh()">
                <svg class="svg-refresh hdmap2-tool_icon" viewBox="0 0 16 16">
                    <use xlink:href="#refresh"></use>
                </svg>
            </li>
            <li class="hdmap2-tool_item openShare" title="分享" data-openType="1">
                <svg class="svg-share hdmap2-tool_icon" viewBox="0 0  12.24 16">
                    <use xlink:href="#share"></use>
                </svg>
                <div class="sharebar sharebar--left" style="display:none;">
                    <ul class="sharebar_list">
                        <li>
                            <a data-share="weibo" class="icon-weibo sharebar_icon"></a>
                            <span class="sharebar_tit">微博</span>
                        </li>
                        <li>
                            <a data-share="qq" class="icon-qq sharebar_icon"></a>
                            <span class="sharebar_tit">QQ</span>
                        </li>

                        <li>
                            <a data-share="douban" class="icon-douban sharebar_icon"></a>
                            <span class="sharebar_tit">豆瓣</span>
                        </li>
                        <li>
                            <a data-share="qzone" class="icon-zone sharebar_icon"></a>
                            <span class="sharebar_tit">QQ空间</span>
                        </li>


                    </ul>

                    <div class="sharebar_wechat clf">
                        <img class="qr-img" alt="">
                        <span>扫一扫分享到微信</span>
                    </div>
                    <i class="sharebar_arr"></i>

                </div>
            </li>
        </ul>
        <a class="hdmap2-old" title="返回到旧版图谱">
            <span>返回
                <br>旧版</span>
        </a>

        <ul id="chks" class="hdmap2-gd">



        </ul>


        <div class="popup " style="display: none;" id="divgd">
            <div class="popup_wrap">
                <div class="popup_inner popup_xs-fsh">
                    <h2 class="popup_tit">添加更多股东</h2>
                    <div class="hdmap2-popup-gd">
                        <ul class="hdmap2-popup-gd_list clf" id="moregd">

                        </ul>
                        <button class="btn green hdmap2-popup-gd_btn" id="btngd">确定选择</button>

                    </div>

                    <i class="popup_close">×</i>


                </div>
            </div>
        </div>

        <div id="main"></div>

        <script type="text/javascript">
            var objdata = {};
            var container;
            var zoom;
            $(document).ready(function () {

                var name = $("#comName").val().trim();
                if (name.length <= 0) {
                    getData("深圳前瞻资讯股份有限公司");
                } else {
                    getData(name);
                }

                $(document).on('click', '#chks .gudongchk', function () {
                    var gudongs = $("#chks").find(".gudongchk:checked");
                    var gudongmore = $("#moregd").find(".gudongchk").removeAttr("checked");
                    var arr = new Array();
                    gudongs.each(function (e) {
                        var chkval = parseInt($(this).val());

                        for (var i = 0; i < gudongmore.length; i++) {
                            if ($(gudongmore[i]).val() == $(this).val()) {
                                $(gudongmore[i]).prop("checked", true);
                            }
                        }

                        arr.push(chkval);
                    });
                    showarr(arr);
                });

                $(document).on('click', '.hdmap2-gd_more', function () {
                    $("#divgd").show();
                });

                $("#btngd").click(function () {
                    var gudongmore = $("#moregd").find(".gudongchk:checked");
                    var gudongs = $("#chks").find(".gudongchk").removeAttr("checked");
                    var arr = new Array();
                    gudongmore.each(function (e) {
                        var chkval = parseInt($(this).val());

                        for (var i = 0; i < gudongs.length; i++) {
                            if ($(gudongs[i]).val() == $(this).val()) {
                                $(gudongs[i]).prop("checked", true);
                            }
                        }
                        arr.push(chkval);
                    });
                    showarr(arr);
                    $("#divgd").hide();
                });

                $(".popup_close").click(function () {
                    $("#divgd").hide();
                });

                //$(document).find("line").attr("style", "stroke-width: 0.5");
                //d3.select('svg').find("line").attr("style", "stroke-width: 0.5");
            });

            function maoRefresh() {
                drawMap(objdata);
            }

            window.onresize = function () {
                $('#main').width(document.body.clientWidth);
                d3.select('#main svg').attr('width', document.body.clientWidth)
                if (document.body.clientHeight > 700) {
                    $('#main').height(document.body.clientHeight - 66);
                    d3.select('#main svg').attr('height', document.body.clientHeight - 66)
                } else {
                    $('#main').height(640);
                    d3.select('#main svg').attr('height', 640);

                }
            }

            function toggleFind(obj) {

                $("#find-company .find-company-list").slideToggle();
                if ($(obj).text() == "-") {
                    $(obj).text("+")
                } else {
                    $(obj).text("-")
                }
            }

            function getData(tip) {
                verify(function (mfccode) {

                    if (!tip || tip == '') {
                        return;
                    }

                    var url = "/OrgCompany/GetData";
                    $.ajax({
                        url: url,
                        type: 'GET',
                        data: {
                            "type": 3,
                            "comName": tip,
                            "mfcCode": mfccode
                        },
                        dataType: 'JSON',
                        success: function (data) {
                            var data = eval(data);

                            var str = "";
                            var gudongarr = new Array();

                            for (var i = 0; i < data.Nodes.length; i++) {
                                if (data.Nodes[i].Category == 2) {
                                    gudongarr.push(data.Nodes[i]);
                                } else if (data.Nodes[i].Category == 1 && data.Nodes[i].nodeId == 0) {
                                    $("#hdtokeyNo").val(data.Nodes[i].KeyNo);
                                }
                            }

                            //var gudongarr = data.Nodes.filter(e=>e.Category === 2);
                            for (var i = 0; i < gudongarr.length; i++) {
                                //str += "<input class=\"gudongchk\" checked=\"checked\" type=\"checkbox\" value=\"" + gudongarr[i].nodeId + "\" /> " + gudongarr[i].Name + "";
                                str += '<li class="hdmap2-gd_item"><label>' + gudongarr[i].Name + '</label><input type="checkbox" class="gudongchk" checked="checked" value=' + gudongarr[i].nodeId + '></li>';
                            }
                            $("#moregd").empty().append(str);
                            if (gudongarr.length > 10) {

                                str += '<li class="hdmap2-gd_more">+ 更多</li>';

                            }
                            $("#chks").empty().append(str);

                            objdata = data;
                            drawMap(data);
                            //$("#main line").attr("style", "");
                        }
                    });

                });

            }

            function saveImg() {
                jietu('main');
            }

            function jietu(svgDivId) {
                var jietuMask = document.createElement("div");
                $(jietuMask).attr('style', 'position: fixed; background: #fff; z-index: 1000; top: 0px; bottom: 0px; left: 0px; right: 0px;');
                document.body.appendChild(jietuMask);


                //var _svgWidth = d3.select('svg').attr('width');
                //var _svgHeight = d3.select('svg').attr('height');
                var _svgWidth = d3.select('#' + svgDivId + ' svg').attr('width');
                var _svgHeight = d3.select('#' + svgDivId + ' svg').attr('height');
                var _scale = zoom.scale();
                var _translate = zoom.translate();

                //zoom.scale(1);
                //zoom.translate([-700, 1]);
                //container.attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");
                ////d3.select('svg').attr('width', 3264);
                ////d3.select('svg').attr('height', 2448);
                //d3.select('#' + svgDivId + ' svg').attr('width', 2000);
                //d3.select('#' + svgDivId + ' svg').attr('height', 1000);

                //zoom.scale(1);
                //zoom.translate([1, 1]);
                //container.attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");
                //d3.select('#' + svgDivId + ' svg').attr('width', 2000);
                //d3.select('#' + svgDivId + ' svg').attr('height', 1000);

                var svgXml = $('#' + svgDivId).html();
                //var image = new Image();
                //image.src = 'data:image/svg+xml;base64,' + window.btoa(unescape(encodeURIComponent(svgXml)));
                //window.win = open (image.src);
                setTimeout(function () {
                    var canvas = document.createElement('canvas');  //准备空画布
                    canvas.width = $('#' + svgDivId + ' svg').width();
                    canvas.height = $('#' + svgDivId + ' svg').height();
                    zoom.scale(_scale);
                    zoom.translate(_translate);
                    container.attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");
                    //d3.select('svg').attr('width', _svgWidth);
                    //d3.select('svg').attr('height', _svgHeight);
                    d3.select('#' + svgDivId + ' svg').attr('width', _svgWidth);
                    d3.select('#' + svgDivId + ' svg').attr('height', _svgHeight);
                    $(jietuMask).css('display', 'none');
                    var context = canvas.getContext('2d');  //取得画布的2d绘图上下文
                    //context.drawImage(image, 0, 0);
                    //var marker = '疑似关系由企查猫(企业查询宝)www.qichamao.com利用大数据分析引擎独家生成。';
                    //context.font = "30px 微软雅黑";
                    //context.fillStyle = "#aaaaaa";
                    //context.fillText(marker, canvas.width / 2 - context.measureText(marker).width / 2, canvas.height - 100);
                    //download(canvas, 'jpg');

                    var text = "疑似关系由企查猫(企业查询宝)www.qichamao.com利用大数据分析引擎独家生成";
                    var x = canvas.width / 2 - context.measureText(text).width;
                    var y = canvas.height - 100;
                    var marker = '<text x="' + x + '" fill="#aaaaaa" style="font-size: 24px;font-family:微软雅黑;" y="' + y + '">' + text + '</text>'
                    //var data = svg.outerHTML;
                    var repstr = marker + "</svg>";
                    svgXml.replace("</svg>", repstr);
                    canvg(canvas, svgXml.replace("</svg>", repstr));

                    var filename = "" + $(".hdmap2-tit").text().trim() + "-疑似关系-企查猫(企业查询宝)www.qichamao.com.png";
                    download(canvas.toDataURL("image/png"), filename, "image/octet-stream");
                }, 100);
            }

            function showarr(arr) {
                var newDataArr = {};
                newDataArr.Links = new Array();
                newDataArr.Nodes = new Array();

                var data = objdata;

                for (var i = 0; i < arr.length; i++) {
                    //var templinks = data.Links.filter(e=>e.Source === arr[i]);
                    ////newDataArr.Links.push(templinks);
                    //newDataArr.Links = newDataArr.Links.concat(templinks);

                    var templinks = new Array();
                    for (var s = 0; s < data.Links.length; s++) {
                        if (data.Links[s].Source == arr[i]) {
                            templinks.push(data.Links[s]);
                        }
                    }
                    newDataArr.Links = newDataArr.Links.concat(templinks);


                    //var tempnode1 = data.Nodes.filter(e=>e.nodeId === arr[i]);
                    //newDataArr.Nodes = newDataArr.Nodes.concat(tempnode1);
                    var tempnode1 = new Array();
                    for (var s = 0; s < data.Nodes.length; s++) {
                        if (data.Nodes[s].nodeId == arr[i]) {
                            tempnode1.push(data.Nodes[s]);
                        }
                    }
                    newDataArr.Nodes = newDataArr.Nodes.concat(tempnode1);



                    for (var j = 0; j < templinks.length; j++) {
                        //var tempnode2 = data.Nodes.filter(e=>e.nodeId === templinks[j].Target);
                        var tempnode2 = new Array();
                        for (var s = 0; s < data.Nodes.length; s++) {
                            if (data.Nodes[s].nodeId == templinks[j].Target) {
                                tempnode2.push(data.Nodes[s]);
                            }
                        }

                        //var hasnode = newDataArr.Nodes.filter(e=>e.nodeId === templinks[j].Target);
                        var hasnode = new Array();
                        for (var s = 0; s < newDataArr.Nodes.length; s++) {
                            if (newDataArr.Nodes[s].nodeId == templinks[j].Target) {
                                hasnode.push(newDataArr.Nodes[s]);
                            }
                        }

                        if (hasnode <= 0) {
                            newDataArr.Nodes = newDataArr.Nodes.concat(tempnode2);
                        }
                    }

                }
                drawMap(newDataArr);
            }


            function fillFindList(data) {
                var findCompany = $('#find-company');
                findCompany.show();
                findCompany.find('.find-company-number').text(data.length);
                findCompany.find('.find-company-list').empty();
                findCompany.find('.find-company-list').empty();
                for (var i = 0; i < data.length; i++) {
                    var html = "<div class='find-mao-list-item' name='" + data[i].CompanyName + "' unique='" + data[i].KeyNo + "'>";
                    html += "<a href='firm_" + data[i].KeyNo + ".shtml' target='_blank'>";
                    html += "<div class='find-mao-float-wrap'>";
                    html += "<div class='find-mao-cop-name'>" + data[i].CompanyName + "</div>";
                    html += "<div class='find-mao-cop-province'>" + data[i].Province + "</div>";
                    html += "</div>";
                    html += "<div class='find-mao-oper'>" + (data[i].Name || "-") + "</div>";
                    html += "<div class='find-mao-float-wrap' style='margin-top: 5px'>";
                    html += "<div class='find-mao-cop-money'>" + (data[i].Money || "-") + "</div>";
                    html += "<div class='find-mao-cop-time'>" + (data[i].Date || "-") + "</div>";
                    html += "</div>";
                    html += "</a>";
                    html += "</div>";
                    findCompany.find('.find-company-list').append(html);
                }
                // findCompany.find('.find-company-list').slimScroll({
                //     wheelStep: 1,
                //     height:500
                // });
            }


            function drawMap(root) {
                $("#main").empty();
                svg = d3.select("#main").append("svg").attr("xmlns", "http://www.w3.org/2000/svg").attr({
                    "width": document.body.clientWidth,
                    "height": document.body.clientHeight - 66
                });
                svg.empty();
                $('#main').width(document.body.clientWidth);
                d3.select('#main svg').attr('width', document.body.clientWidth)
                if (document.body.clientHeight > 700) {
                    $('#main').height(document.body.clientHeight - 66);
                    d3.select('#main svg').attr('height', document.body.clientHeight - 66)
                } else {
                    $('#main').height(640);
                    d3.select('#main svg').attr('height', 640);

                }

                container = svg.append("g");

                zoom = d3.behavior.zoom()
                    .scaleExtent([1, 3])
                    .on("zoom", zoomed);
                svg.call(zoom);

                function zoomed() {
                    // container.attr("transform", d3.event.transform);
                    container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                }
                function initLocation() {
                    zoom.translate([1, 1]);
                    zoom.scale(1);
                    container.attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");
                }

                initLocation();

                var width = svg.attr('width');
                var height = svg.attr('height');


                var defs = container.append("defs");

                var arrowMarker = defs.append("marker")
                    .attr("id", "arrow")
                    .attr("markerUnits", "strokeWidth")
                    .attr("markerWidth", "12")
                    .attr("markerHeight", "12")
                    .attr("viewBox", "0 0 12 12")
                    .attr("refX", "50")
                    .attr("refY", "6")
                    .attr("orient", "auto");

                var arrowMarker2 = defs.append("marker")
                    .attr("id", "arrow2")
                    .attr("markerUnits", "strokeWidth")
                    .attr("markerWidth", "12")
                    .attr("markerHeight", "12")
                    .attr("viewBox", "0 0 12 12")
                    .attr("refX", "85")
                    .attr("refY", "6")
                    .attr("orient", "auto");
                var arrow_path = "M2,2 L10,6 L2,10 L6,6 L2,2";

                arrowMarker.append("path")
                    .attr("d", arrow_path)
                    .attr("fill", "#000");
                arrowMarker2.append("path")
                    .attr("d", arrow_path)
                    .attr("fill", "#000");


                var copNum = 0;
                var copFlag = 0;
                for (var i = 0; i < root.Nodes.length; i++) {
                    if (root.Nodes[i].Category == 2) {
                        root.Nodes[i].level = 0;
                    } else {
                        copNum++;
                    }
                }

                for (var i = 0; i < root.Nodes.length; i++) {
                    if (root.Nodes[i].Category == 1) {
                        if (copFlag < copNum / 2) {
                            root.Nodes[i].level = 1;
                            copFlag++;
                        } else {
                            root.Nodes[i].level = 2;
                        }
                    }
                }

                var nodes = [];
                var tempNodesIndex = [];
                for (var i = 0; i < root.Nodes.length; i++) {
                    var tempR = 20;
                    if (root.Nodes[i].Category == 1) {
                        tempR = 38;
                    } else {
                        tempR = 20;
                    }
                    nodes.push({
                        "nodeId": root.Nodes[i].nodeId,
                        "keyNo": root.Nodes[i].KeyNo,
                        "name": root.Nodes[i].Name,
                        "category": root.Nodes[i].Category,
                        "shortName": root.Nodes[i].ShortName,
                        "r": tempR,
                        "level": root.Nodes[i].level
                    });
                    tempNodesIndex.push(root.Nodes[i].nodeId);
                }
                tempNodesIndex.reverse();
                nodes.reverse();

                var links = [];
                for (var i = 0; i < root.Links.length; i++) {
                    links.push({
                        "source": tempNodesIndex.indexOf(root.Links[i].Source),
                        "target": tempNodesIndex.indexOf(root.Links[i].Target),
                        "relation": root.Links[i].Relation.toString()
                    });
                }

                var force = d3.layout.force()
                    .nodes(nodes)
                    .links(links)
                    .size([width, height])
                    .linkDistance(200)
                    .charge(-1500)
                    .start();

                var edges_line = container.selectAll("line")
                    .data(links)
                    .enter()
                    .append("path")
                    //.attr("class", function (d) {
                    //    //if (d.target.r == 20) {
                    //        return "link-np"
                    //    //}
                    //    //return "link"
                    //});
                    .style("fill", "#aaa")
                    .style("stroke", "#aaa")
                    .style("stroke-opacity", ".5")
                //.style("stroke", "#aaa")
                //.style("stroke-width", 0.5)
                //.attr("marker-end", function (d) {
                //    if (d.target.r == 20) {
                //        return "url(#arrow)";
                //    } else {
                //        return "url(#arrow2)";
                //    }
                //});

                var edges_text = container.selectAll(".linetext")
                    .data(links)
                    .enter()
                    .append("text")
                    //.attr("class", "linetext")
                    .style("font-size", "12px")
                    .attr("fill", "#bbb")
                    .text(function (d) {
                        return d.relation;
                    });

                var drag = force.drag()
                    .on("dragstart", function (d, i) {
                        //zoom.translate([1, 1]);
                        //svg.call(zoom,null);
                        d.fixed = true;    //拖拽开始后设定被拖拽对象为固定
                        d3.event.sourceEvent.stopPropagation();
                    });

                var nodes_circle = container.selectAll("circle")
                    .data(nodes)
                    .enter()
                    .append("circle")
                    .attr("class", "node")
                    .attr("r", function (d) { return d.r + 5; })
                    .style("fill", function (d, i) {
                        if (d.category == 1) {
                            return "#7187D9";
                        } else {
                            return "#18b470";
                        }
                    })
                    .style("cursor", "pointer")
                    .on("mouseover", function (d) {
                        if (d.category == 1) {
                            this.style.fill = "#5d67c0";
                        } else {
                            this.style.fill = "#209b7f";
                        }

                        mouseOver(d);
                    })
                    .on("mouseout", function (d) {
                        if (d.category == 1) {
                            this.style.fill = "#7187D9";
                        } else {
                            this.style.fill = "#18b470";
                        }

                        mouseOut(d);
                    })
                    .on("mousemove", function () {
                        nozoom();
                    })
                    .on("touchstart", function (d) {
                        if (d.category == 1) {
                            this.style.fill = "#5d67c0";
                        } else {
                            this.style.fill = "#209b7f";
                        }

                        mouseOver(d);
                    })
                    .on("touchend", function (d) {
                        if (d.category == 1) {
                            this.style.fill = "#7187D9";
                        } else {
                            this.style.fill = "#18b470";
                        }

                        mouseOut(d);
                    })
                    .on("click", function (d, i) {
                        if (d3.event.defaultPrevented) return;// ignore drag
                        if (d.category == 1 && d.keyNo != null) {
                            getCompanyInfo(d.keyNo, 0);
                        } else {
                            $.ajax({
                                url: "/OrgCompany/ToPersonView",
                                type: 'GET',
                                data: {
                                    "keyNo": "",
                                    "personName": d.name
                                },
                                //dataType: 'JSON',
                                success: function (data) {
                                    document.getElementById("alink").href = data;
                                    document.getElementById("alink").click();
                                },
                                async: false
                            });
                        }
                    })
                    .call(drag);


                var nodes_text = container.selectAll(".nodetext")
                    .data(nodes)
                    .enter()
                    .append("g")
                    //.attr("class", "nodetext")
                    .style("font-size", "12px")
                    .style("fill", "#fff")
                    .attr("keyNo", function (d) {
                        return d.keyNo;
                    })
                    .style("cursor", "pointer")
                    .on("mouseover", function (t) {
                        nodes_circle.style("fill", function (d) {
                            if (t.index == d.index) {
                                if (d.category == 1) {
                                    return "#5d67c0";
                                } else {
                                    return "#209b7f";
                                }
                            }
                            else {
                                if (d.category == 1) {
                                    return "#7187D9";
                                } else {
                                    return "#18b470";
                                }
                            }
                        });
                        mouseOver(t);
                    })
                    .on("mouseout", function (d) {
                        nodes_circle.style("fill", function (d) {
                            if (d.category == 1) {
                                return "#7187D9";
                            } else {
                                return "#18b470";
                            }
                        });
                        mouseOut(d);
                    })
                    .on("touchstart", function (d) {
                        //if (d.category == 1) {
                        //    this.style.fill = "#5d67c0";
                        //} else {
                        //    this.style.fill = "#209b7f";
                        //}

                        mouseOver(d);
                    })
                    .on("touchend", function (d) {
                        //if (d.category == 1) {
                        //    this.style.fill = "#7187D9";
                        //} else {
                        //    this.style.fill = "#18b470";
                        //}

                        mouseOut(d);
                    })
                    .on("mousemove", function () {
                        nozoom();
                    })
                    .on("click", function (d, i) {
                        if (d3.event.defaultPrevented) return;
                        if (d.category == 1 && d.keyNo != null) {
                            getCompanyInfo(d.keyNo, 0);
                        } else {
                            $.ajax({
                                url: "/OrgCompany/ToPersonView",
                                type: 'GET',
                                data: {
                                    "keyNo": "",
                                    "personName": d.name
                                },
                                //dataType: 'JSON',
                                success: function (data) {
                                    document.getElementById("alink").href = data;
                                    document.getElementById("alink").click();
                                },
                                async: false
                            });
                        }
                    })
                    .call(drag);

                nodes_text.each(function (d, i) {
                    var lines = Math.ceil(d.name.length / 5);
                    var text = "";
                    var dx = 0;
                    var dy = 0;
                    for (var line = 0; line < lines; line++) {
                        if (d.category == 2) {
                            dx = 0 - d.name.length * 6;
                            dy = 3;
                            d3.select(this).append("text").attr("dx", dx).attr("dy", dy).text(d.name);
                        } else {
                            dx = -12 * 2.3;
                            if (line == (lines - 1)) {
                                dx = 0 - 6 * (d.name.substr(line * 5, 5).length);
                            }
                            dy = 14 * line - lines * 2.3;
                            d3.select(this).append("text").attr("dx", dx).attr("dy", dy).text(d.name.substr(line * 5, 5));
                        }

                        //text += "<text dx='"+dx+"' dy='"+dy+"'>"+ d.name.substr(line*5, 5)+"</text>";
                    }
                });

                function mouseOver(d) {
                    edges_line.each(function (line) {
                        if (line.source.nodeId == d.nodeId || line.target.nodeId == d.nodeId) {
                            d3.select(this).style("stroke", "#128bed").style("fill", "#128bed");
                        }
                    });

                    edges_text.each(function (line) {
                        if (line.source.nodeId == d.nodeId || line.target.nodeId == d.nodeId) {
                            d3.select(this).style("fill", "#128bed");
                        }
                    });

                }

                function mouseOut(d) {
                    edges_line.each(function (line) {
                        if (line.source.nodeId == d.nodeId || line.target.nodeId == d.nodeId) {
                            d3.select(this).style("stroke", "#aaa").style("fill", "#aaa");
                        }
                    });

                    edges_text.each(function (line) {
                        if (line.source.nodeId == d.nodeId || line.target.nodeId == d.nodeId) {
                            d3.select(this).style("fill", "#bbb");
                        }
                    });
                }


                force.on("tick", function () {

                    //限制结点的边界
                    nodes.forEach(function (d, i) {
                        d.x = d.x < d.r ? d.r : d.x;
                        d.x = d.x > width - d.r ? width - d.r : d.x;
                        d.y = d.y < d.r ? d.r : d.y;
                        d.y = d.y > height - d.r ? height - d.r : d.y;
                    });

                    //更新连接线的位置
                    //edges_line.attr("x1", function (d) { return d.source.x; });
                    //edges_line.attr("y1", function (d) { return d.source.y; });
                    //edges_line.attr("x2", function (d) { return d.target.x; });
                    //edges_line.attr("y2", function (d) { return d.target.y; });

                    edges_line.attr("d", function (d) {
                        var dx = d.target.x - d.source.x;
                        var dy = d.target.y - d.source.y;
                        var dr = Math.sqrt(dx * dx + dy * dy);
                        //theta = Math.atan2(dy, dx) + Math.PI / 7.85,
                        var theta = Math.atan2(dy, dx) + Math.PI / 720;
                        var d90 = Math.PI / 2;
                        var dtxs = d.target.x - 42 * Math.cos(theta);
                        var dtys = d.target.y - 42 * Math.sin(theta);
                        return "M" + d.source.x + "," + d.source.y
                            //+ "A" + dr + "," + dr + " 0 0 1," + d.target.x + "," + d.target.y + "A" + dr + "," + dr + " 0 0 0," + d.source.x + "," + d.source.y
                            + "L" + d.target.x + "," + d.target.y
                            + "M" + dtxs + "," + dtys + "l" + (3.5 * Math.cos(d90 - theta) - 10 * Math.cos(theta)) + "," + (-3.5 * Math.sin(d90 - theta) - 10 * Math.sin(theta)) + "L" + (dtxs - 3.5 * Math.cos(d90 - theta) - 10 * Math.cos(theta)) + "," + (dtys + 3.5 * Math.sin(d90 - theta) - 10 * Math.sin(theta)) + "z";
                    });

                    //更新连接线上文字的位置
                    edges_text.attr("x", function (d) { return (d.source.x + d.target.x) / 2 - d.relation.length / 2 * 10; });
                    edges_text.attr("y", function (d) { return (d.source.y + d.target.y) / 2 - 5; });
                    edges_text.attr("transform", function (d) {
                        var x = (d.source.x + d.target.x) / 2;
                        var y = (d.source.y + d.target.y) / 2;
                        var angle = 0;
                        if (d.target.x - d.source.x == 0) {
                            if (d.target.y > d.source.y) {
                                angle = 90;
                            } else {
                                angle = -90
                            }
                        } else {
                            angle = Math.atan((d.target.y - d.source.y) / (d.target.x - d.source.x)) * 180 / Math.PI;
                        }
                        return "rotate(" + angle + " " + x + "," + y + ")";
                    })



                    //更新结点图片和文字
                    nodes_circle.attr("cx", function (d) { return d.x; });
                    nodes_circle.attr("cy", function (d) { return d.y; });

                    nodes_text.attr("x", function (d) {
                        d3.select(this).selectAll("text").attr("x", d.x);
                        return d.x
                    });
                    nodes_text.attr("y", function (d) {
                        d3.select(this).selectAll("text").attr("y", d.y);
                        return d.y;
                    });
                });

                var legend = svg.append("g");

                legend.append("circle")
                    .attr("r", 8)
                    .style("fill", "#18b470")
                    .attr("cx", width - 100)
                    .attr("cy", 50);
                legend.append("text")
                    .text("自然人")
                    .attr("x", width - 85)
                    .attr("y", 55);

                legend.append("circle")
                    .attr("r", 8)
                    .style("fill", "#7187D9")
                    .attr("cx", width - 100)
                    .attr("cy", 75);
                legend.append("text")
                    .text("公司")
                    .attr("x", width - 85)
                    .attr("y", 80);


            }

            // 获取url中的参数
            function getQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return decodeURIComponent(r[2]); return null;
            }

            function nozoom() {
                d3.event.preventDefault();
            }

            function download2(canvas, type) {
                //设置保存图片的类型
                var imgdata = canvas.toDataURL(type);
                //将mime-type改为image/octet-stream,强制让浏览器下载
                var fixtype = function (type) {
                    type = type.toLocaleLowerCase().replace(/jpg/i, 'jpeg');
                    var r = type.match(/png|jpeg|bmp|gif/)[0];
                    return 'image/' + r;
                }
                imgdata = imgdata.replace(fixtype(type), 'image/octet-stream')
                //将图片保存到本地
                var saveFile = function (data, filename) {
                    var link = document.createElement('a');
                    link.href = data;
                    link.download = filename;
                    var event = document.createEvent('MouseEvents');
                    event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                    link.dispatchEvent(event);
                }
                //var filename = new Date().toLocaleDateString() + '.' + type;
                var filename = "" + $(".hdmap2-tit").text().trim() + "-疑似关系-企查猫(企业查询宝)www.qichamao.com" + '.' + type;
                saveFile(imgdata, filename);
            }

        </script>
    </article>
    <div class="bg-fixed" style="display: none;"></div>
    <!-- 企业图谱弹出信息框 -->
    <div class="hdmappop2" style="display: none;">
        <div class="hdmappop2-tit">公司信息</div>
        <div class="hdmappop2-info">
            <div class="tit">
                <span>正常</span>
                <em>腾讯科技(深圳)有限公司有限公司有限公司</em>
            </div>
            <div class="info-wrap">
                <div class="info">
                    <span>企业法人：</span>马化腾</div>
                <div class="info">
                    <span>注册资本：</span>1000万元</div>
                <div class="info">
                    <span>成立时间：</span>2010-11-23</div>
            </div>
            <div class="btn-wrap">
                <a href="" class="btn green">企业图谱</a>
                <a href="" class="btn green">企业详情</a>
            </div>
        </div>
        <div class="hdmappop2-tab">
            <a href="" class="current">股东</a>
            <a href="">对外投资</a>
        </div>
        <div class="hdmappop2-box" style="display: ;">
            <table class="hdmappop2-gd ">
                <thead>
                    <tr>
                        <th>名称</th>
                        <th>类型</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>张金海</td>
                        <td>自然人</td>
                    </tr>
                    <tr>
                        <td>余秋宁</td>
                        <td>自然人</td>
                    </tr>
                    <tr>
                        <td>杨敦荣</td>
                        <td>自然人</td>
                    </tr>
                    <tr>
                        <td>张金海</td>
                        <td>自然人</td>
                    </tr>
                    <tr>
                        <td>余秋宁</td>
                        <td>自然人</td>
                    </tr>
                    <tr>
                        <td>杨敦荣</td>
                        <td>自然人</td>
                    </tr>
                    <tr>
                        <td>杨敦荣</td>
                        <td>自然人</td>
                    </tr>

                </tbody>
            </table>
        </div>
        <ul class="hdmappop2-tzr hdmappop2-box" style="display: none;">
            <li>
                <i class="squ"></i>
                <em>腾讯科技（深圳）有限公司</em>
            </li>
            <li>
                <i class="squ"></i>
                <a href="">南京颂歌网络科技有限公司南京颂歌网络科技有限公司南京颂歌网络科技有限公司</a>
            </li>
            <li>
                <i class="squ"></i>
                <em>腾讯科技（深圳）有限公司</em>
            </li>
            <li>
                <i class="squ"></i>
                <em>南京颂歌网络科技有限公司</em>
            </li>
            <li>
                <i class="squ"></i>
                <em>腾讯科技（深圳）有限公司</em>
            </li>
            <li>
                <i class="squ"></i>
                <em>南京颂歌网络科技有限公司</em>
            </li>
            <li>
                <i class="squ"></i>
                <em>南京颂歌网络科技有限公司</em>
            </li>
            <li>
                <i class="squ"></i>
                <em>南京颂歌网络科技有限公司</em>
            </li>
            <li>
                <i class="squ"></i>
                <em>南京颂歌网络科技有限公司</em>
            </li>
            <li>
                <i class="squ"></i>
                <em>南京颂歌网络科技有限公司</em>
            </li>
        </ul>
        <i class="close">×</i>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg " xmlns:xlink="http://www.w3.org/1999/xlink " width="0 " height="0 " style="position:absolute ">
        <defs>
            <svg id="export" viewBox="0 0 16 16 ">
                <path class="st0" d="M324.2-93.81L298.81 38.9h-561.16l-25.39-132.71H-350v210.53h737.28V-93.81H324.2z"></path>
                <path class="st0" d="M8.05 12.52L.09 5.3h5.03V0H11v5.3h5.08l-8.03 7.22zm6.03.58H1.9l-.55-1.88H0V16h16v-4.78h-1.37l-.55 1.88z"></path>
            </svg>
            <svg id="plus" viewBox="0 0 16 16 ">
                <path d="M9.44 6.56V0H6.56v6.56H0v2.88h6.56V16h2.88V9.44H16V6.56z "></path>
            </svg>
            <svg id="minus" viewBox="0 0 16 4.5 ">
                <path class="st0" d="M0 0h16v4.5H0z"></path>
                <path class="st0" d="M290.2-99.56L264.81 33.15h-561.16l-25.39-132.71H-384v210.53h737.28V-99.56H290.2z"></path>
            </svg>
            <svg id="share" viewBox="0 0 12.24 16 ">
                <path class="st0 " d="M9.41 10.35c-.66 0-1.27.23-1.75.6L5.43 9.08a2.816 2.816 0 0 0-.08-2.36l1.88-1.75c.3.13.65.21 1.01.21a2.59 2.59 0 0 0 2.59-2.59A2.597 2.597 0 0 0 8.24 0a2.59 2.59 0 0 0-2.59 2.59c0 .29.05.56.13.82L3.72 5.32c-.28-.09-.58-.15-.9-.15C1.26 5.18 0 6.44 0 8a2.817 2.817 0 0 0 3.93 2.59l2.67 2.25a2.817 2.817 0 0 0 2.8 3.15c1.56 0 2.82-1.26 2.82-2.82.02-1.55-1.25-2.82-2.81-2.82m0 0 "></path>
            </svg>
            <svg id="refresh" viewBox="0 0 16 16 ">
                <path d="M13.31 2.69C11.91 1.29 10.02.52 7.99.52c-2.03 0-3.92.77-5.32 2.17C1.27 4.09.5 5.98.5 8.01c0 2.03.77 3.92 2.17 5.32 1.43 1.43 3.39 2.16 5.35 2.16 1.58 0 3.15-.47 4.45-1.44l.32-.24-1.51-1.51-.23.16c-1.65 1.14-3.8 1.23-5.61.25-1.81-.98-2.9-2.84-2.85-4.84.06-2.15 1.37-3.99 3.43-4.81 2.05-.82 4.27-.38 5.78 1.14a5.37 5.37 0 0 1 1.56 4.24H9.42l4.38 4.38.24-.32c2.2-2.98 1.89-7.19-.73-9.81z"></path>
            </svg>
        </defs>
    </svg>

    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/svgsprite.js"></script>
    <script src="https://img1.qianzhan.com/qiye/20171201/scripts/svgsprite-logo.js"></script>
</body>

</html>